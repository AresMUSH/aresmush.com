<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>Database Queries and Updates - </title>
    <meta property="og:title" content="Database Queries and Updates - ">
    <meta name="twitter:title" content="Database Queries and Updates - ">
    <meta itemprop="name" content="Database Queries and Updates - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="Database Queries and Updates" >
    <meta property="og:url" content="/tutorials/code/quickstart/db-intro.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

                               
             <div class="page">
                 
                 <h1>Database Queries and Updates</h1>
                 
                 <div class="fs3-shortcut">
                     <a href="#toc">(View Table of Contents)</a>
                 </div>
                 

                     <p>Most commands will need to read data from or save data to the database.  Ares uses an off-the-shelf database server called Redis, but you won’t interact with the database directly.  There are no SQL queries to write or anything like that.  The <a href="http://ohm.keyvalue.org/">Ohm</a> database library lets you interact with the database using Ruby code.</p>

<p>Diving deep into the database is beyond the Quickstart Tutorial.  This is just a quick overview, and we’ll cover more in the later tutorials.  There’s also a separate  <a href="/tutorials/code/database.html">database tutorial</a> for you in the Advanced Coding section when you get more comfortable.</p>

<h2 id="models-and-fields">Models and Fields</h2>

<p>Ohm lets you define ruby classes that interact with the database.  These are called <strong>Models</strong>, and you can identify them by the fact that they inherit from <code class="language-ruby highlighter-rouge"><span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span></code>.   Model classes define attributes that correspond to fields in the database.  For example, the <code class="language-ruby highlighter-rouge"><span class="no">Character</span></code> class defines a name and alias:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">attribute</span> <span class="ss">:name</span>
  <span class="n">attribute</span> <span class="ss">:alias</span>
  <span class="o">...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We’re already seen how we can utilize the name attribute in our code through examples like <code class="language-ruby highlighter-rouge"><span class="n">client</span><span class="p">.</span><span class="nf">emit</span> <span class="s2">"Hello </span><span class="si">#{</span><span class="n">enactor</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">!"</span></code>   In that case, <code class="language-ruby highlighter-rouge"><span class="n">enactor</span></code> is an instance of a character model, and <code class="language-ruby highlighter-rouge"><span class="nb">name</span></code> is the database field.</p>

<h2 id="try-it---queries">Try It! - Queries</h2>

<p>There are a variety of ways to query (request) information from the database, but the most common one will be to find something by name.   Let’s see how that works.   Change the tinker command as shown:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">handle</span>
  <span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">name</span> <span class="o">==</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">args</span> <span class="p">}.</span><span class="nf">first</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">char</span><span class="p">)</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">emit</span> <span class="s2">"You found </span><span class="si">#{</span><span class="n">char</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">else</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">emit</span> <span class="s2">"Nothing found."</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Try the command with different names and see what happens.</p>

<p>You may have noticed that this version will not find “Faraday” if you typed “faraday” - it’s very literal.  It also won’t search by alias.</p>

<p>Since searching by name is so common, there’s a utility method to help you with these things.  Change the <code class="language-ruby highlighter-rouge"><span class="n">char</span> <span class="o">=</span> </code> line in the handle method to this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">find_one_by_name</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="nf">args</span><span class="p">)</span>
</code></pre></div></div>

<p>Now try the searches again with aliases and different capitalization.  It works much better.</p>

<p>There are some other query helpers, which you can read about in the advanced <a href="/tutorials/code/database.html">database tutorial</a> when you’re ready.</p>

<h2 id="try-it---updates">Try It! - Updates</h2>

<p>Once you have the database object, you can use the <code class="language-ruby highlighter-rouge"><span class="n">update</span></code> method to change its fields.  Here’s how we can change Guest-1’s alias to “guest”:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">handle</span>
  <span class="n">char</span> <span class="o">=</span> <span class="no">Character</span><span class="p">.</span><span class="nf">find_one_by_name</span><span class="p">(</span><span class="s1">'Guest-1'</span><span class="p">)</span>
  <span class="n">char</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">alias: </span><span class="s2">"guest"</span><span class="p">)</span>
  <span class="n">client</span><span class="p">.</span><span class="nf">emit</span> <span class="s2">"Done!"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="alert alert-info">
<p><i class="fa fa-exclamation-triangle"></i> <b>Note</b></p>
<p>ust setting the class attribute (like <code>char.alias = 'guest'</code>) will change the local copy of the object, but it doesn't update the database.  Always call <code>update</code> to save database changes.</p>
</div>



                 <div class="tutorial-nav">
                     <p>This article is part of the <a href="/tutorials/code/quickstart">Code Quickstart</a> tutorial.</p>
    
                     <div class="pagination-block">
                         <ul>
                             
                             <li><a href="/tutorials/code/quickstart/localization-intro.html"> &larr; Previous</a></li>
                             
            
                             <li><a href="/tutorials/code/quickstart">Back to Start</a> </li>
            
        
                             
                             <li><a href="/tutorials/code/quickstart/apis.html">Next &rarr; </a></li>
                             
                         </ul>
                     </div>
    
                     <br/>
                 </div>
                 
             </div>             
                           </div>
              
              
                  <div class="col col-sm-3">
                      
                      
                      <a name="toc"></a>
                      <div class="sidebar fs3-sidebar"> 
                      
                        <div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                      
                      <h2>Code Quickstart</h2>
                      
                     
                      
                                          
                      
                                          
                      
                                          
                                          <ul>
  <li><a href="/tutorials/code/quickstart/">Tutorial Overview</a></li>
  <li><a href="/tutorials/code/quickstart/try-ruby.html">Try Ruby</a></li>
  <li><a href="/tutorials/code/quickstart/hello-mush.html">Hello MUSH</a></li>
  <li><a href="/tutorials/code/quickstart/tinker-intro.html">Tinkering</a></li>
  <li><a href="/tutorials/code/quickstart/command-handlers.html">Command Handlers</a></li>
  <li><a href="/tutorials/code/quickstart/emits.html">Emits</a></li>
  <li><a href="/tutorials/code/quickstart/templates-intro.html">Templates</a></li>
  <li><a href="/tutorials/code/quickstart/command-args.html">Command Switches and Args</a></li>
  <li><a href="/tutorials/code/quickstart/parsing-args.html">Parsing Args</a></li>
  <li><a href="/tutorials/code/quickstart/command-errors.html">Command Error Checking</a></li>
  <li><a href="/tutorials/code/quickstart/config-intro.html">Configuration</a></li>
  <li><a href="/tutorials/code/quickstart/localization-intro.html">Localization</a></li>
  <li><a href="/tutorials/code/quickstart/db-intro.html">Database Queries and Updates</a></li>
  <li><a href="/tutorials/code/quickstart/apis.html">Common APIs</a></li>
  <li><a href="/tutorials/code/quickstart/next-steps.html">Next Steps</a></li>
</ul>

                                          
                      
                                          
                      
                                          
                      
                                          
                      
                  </div>
              </div>

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>
              
</div>


                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
