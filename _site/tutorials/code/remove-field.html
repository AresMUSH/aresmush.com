<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>Removing a Database Field - </title>
    <meta property="og:title" content="Removing a Database Field - ">
    <meta name="twitter:title" content="Removing a Database Field - ">
    <meta itemprop="name" content="Removing a Database Field - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="Removing a Database Field" >
    <meta property="og:url" content="/tutorials/code/remove-field.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

<h1>Removing a Database Field</h1>

    <div class="tags-box">
                 <ul class="tags-box">
                 
                 <li>[code]</li>
                 
                 <li>[database]</li>
                 
                 </ul>
    </div>
                               
             <div class="page">
                 <p>Ares uses the <a href="http://ohm.keyvalue.org/">Ohm</a> database library to access fields in the Redis database.  Adding new fields to Ohm database models is very easy.  Removing them requires a little more work.</p>

<div id="inline_toc">
  <p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#why-removing-is-tricky" id="markdown-toc-why-removing-is-tricky">Why Removing is Tricky</a></li>
  <li><a href="#removing-fields-safely" id="markdown-toc-removing-fields-safely">Removing Fields Safely</a></li>
  <li><a href="#errors-during-restart" id="markdown-toc-errors-during-restart">Errors During Restart</a></li>
  <li><a href="#errors-after-upgrades" id="markdown-toc-errors-after-upgrades">Errors After Upgrades</a></li>
</ul>

</div>

<h2 id="why-removing-is-tricky">Why Removing is Tricky</h2>

<p>For example - let’s say that you had an attribute named favorite_color on the Character class:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">attribute</span> <span class="ss">:name</span>
  <span class="n">attribute</span> <span class="ss">:favorite_color</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You make some code to set it, and now some characters have a favorite color.</p>

<p>Now you’ve decided you don’t need favorite color after all.   You remove it from the class.  Everything seems fine, but then you start seeing all kinds of warning messages in the logs:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">WARN</span> <span class="o">-</span> <span class="no">Model</span> <span class="no">AresMUSH</span><span class="o">::</span><span class="no">Character</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">respond</span> <span class="n">to</span> <span class="n">favorite_color</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`favorite_color='
</span></code></pre></div></div>

<p>This is happening because you’ve got data for <code class="language-ruby highlighter-rouge"><span class="n">favorite_color</span></code> in the databse, but nowhere to put it on the Character object!   Ohm assumes that’s a coding mistake and gives you a warning.</p>

<h2 id="removing-fields-safely">Removing Fields Safely</h2>

<p>To prevent this from happening, you should set all instances of the field to <code class="language-ruby highlighter-rouge"><span class="kp">nil</span></code> in the database <strong>before</strong> removing it from the code.</p>

<div class="alert alert-info">
<p><i class="fa fa-exclamation-triangle"></i> <b>Note</b></p>
<p>If the field was originally a special data type (like DateTime or Integer) we need to change it to a string data type first by removing the `type` specification.  Otherwise our nil may be converted to a default value (like 0).</p>
</div>

<p>For example, assume we have:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">attribute</span> <span class="ss">:favorite_number</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">DataType</span><span class="o">::</span><span class="no">Integer</span>
<span class="k">end</span>
</code></pre></div></div>

<p>First we would change the field to a string attribute and then reload the affected plugin:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">attribute</span> <span class="ss">:favorite_number</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then we can use a <a href="/tutorials/code/tinker.html">tinker</a> command to reset everyone’s colors:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">handle</span>
  <span class="no">Character</span><span class="p">.</span><span class="nf">all</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">favorite_number: </span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now it’s safe to remove the field from the code.</p>

<div class="alert alert-success">
<p><i class="fa fa-info-circle"></i> <b>Tip</b></p>
<p>If you forgot to nil out the field before you removed it from the code, just put it back temporarily.  Run the commands above, then remove it for real.</p>
</div>

<h2 id="errors-during-restart">Errors During Restart</h2>

<p>Sometimes you’ll get in a jam when you’ve shut down the game and it won’t restart due to the database error.  You can’t use tinker to fix the problem because you can’t get onto the game!</p>

<p>When this happens, you can use a database script to help you.</p>

<ol>
  <li>Edit the file <code class="language-ruby highlighter-rouge"><span class="n">aresmush</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">remove_db_field</span><span class="p">.</span><span class="nf">rb</span></code> to add back the field temporarily and clear it out. The code is basically the same as what you would have used in the tinker example above.  There’s some sample code in the file you can modify.</li>
  <li>Run the script using <code class="language-ruby highlighter-rouge"><span class="n">bin</span><span class="o">/</span><span class="n">script</span> <span class="n">remove_db_field</span></code>.</li>
  <li>Restart the game.</li>
</ol>

<h2 id="errors-after-upgrades">Errors After Upgrades</h2>

<p>If you get these errors after a code upgrade, it’s likely that you just forgot to run a database migration during a <a href="/tutorials/manage/upgrades.html">code upgrade</a>.</p>

             </div>             
                           </div>
              
                           <div class="col col-sm-3">
                                                 <div class="sidebar">   
                 
<div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                  
<div class="sidebar-title">See AresMUSH In Action</div>

<p>Visit the Ares <a href="http://mush.aresmush.com">Demo Game</a>.</p>

<p>Find other Ares games at <a href="http://arescentral.aresmush.com">AresCentral</a>.</p>


<div class="sidebar-title">Follow Us on Facebook</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1423276681271936";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-page" data-href="https://www.facebook.com/aresmush/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/aresmush/"><a href="https://www.facebook.com/aresmush/">Ares Mush</a></blockquote></div></div>

<div class="sidebar-title">Discuss Ares</div>

Have a question?  Want to talk about AresMUSH (or MU*s in general)?  Visit our <a href="http://forum.aresmush.com">Discussion Forum</a>.
                  
                  

                  <div class="sidebar-title">Stay Up to Date</div>
                          
                          Get important updates about Ares on <a href="https://www.facebook.com/aresmush/">Facebook</a> or the <a href="http://forum.aresmush.com">Discussion Forum</a>.

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>

                  

                  
                
                  
                           </div>
</div>
                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
