<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>Event Handling - </title>
    <meta property="og:title" content="Event Handling - ">
    <meta name="twitter:title" content="Event Handling - ">
    <meta itemprop="name" content="Event Handling - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="Event Handling" >
    <meta property="og:url" content="/tutorials/code/events.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

<h1>Event Handling</h1>

    <div class="tags-box">
                 <ul class="tags-box">
                 
                 <li>[code]</li>
                 
                 <li>[plugins]</li>
                 
                 <li>[events]</li>
                 
                 <li>[dispatcher]</li>
                 
                 </ul>
    </div>
                               
             <div class="page">
                 <p>Where command handling is triggered by a player typing something, Events are triggered by the game itself in response to something happening.  There are events for characters connecting and disconnecting, characters being created, the game starting, and more.</p>

<div id="inline_toc">
  <p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#event-dispatching" id="markdown-toc-event-dispatching">Event Dispatching</a></li>
  <li><a href="#handling-events" id="markdown-toc-handling-events">Handling Events</a>    <ul>
      <li><a href="#get-event-handler" id="markdown-toc-get-event-handler">Get Event Handler</a></li>
      <li><a href="#event-handler-class" id="markdown-toc-event-handler-class">Event Handler Class</a></li>
    </ul>
  </li>
  <li><a href="#standard-events" id="markdown-toc-standard-events">Standard Events</a></li>
  <li><a href="#plugin-events" id="markdown-toc-plugin-events">Plugin Events</a></li>
</ul>

</div>

<h2 id="event-dispatching">Event Dispatching</h2>

<p>When a code module triggers an event, several things happen:</p>

<ol>
  <li>The Event object is added to the <a href="/tutorials/code/dispatcher.html">Dispatcher’s</a> dispatch queue.</li>
  <li>When it gets to that item in the queue, the Dispatcher will ask each plugin if it’s interested in that event.</li>
  <li>If a plugin returns an event handler object, the Dispatcher will call <code class="language-ruby highlighter-rouge"><span class="n">on_event</span></code> in the handler.  It then continues on to the next plugin and does the same.</li>
  <li>If no plugins handle the event, the Dispatcher will ignore it.</li>
</ol>

<div class="alert alert-success">
<p><i class="fa fa-info-circle"></i> <b>Tip</b></p>
<p>Multiple plugins may handle a single event.</p>
</div>

<h2 id="handling-events">Handling Events</h2>

<p>There are two things required to handle events:</p>

<h3 id="get-event-handler">Get Event Handler</h3>

<p>All plugins have a <code class="language-ruby highlighter-rouge"><span class="n">get_event_handler</span></code> method.  Just like <code class="language-ruby highlighter-rouge"><span class="n">get_cmd_handler</span></code> returns a command handler class when a plugin wants a command, <code class="language-ruby highlighter-rouge"><span class="n">get_event_handler</span></code> returns an event handler class when a plugin wants an event.</p>

<p>In this method, events are identified by a string corresponding to the event name (“CharConnectedEvent”, “CharCreatedEvent”, etc.)  Again, this is similar to the way that commands are identified by their command root (“forum”, “connect”, etc.)</p>

<p>The <code class="language-ruby highlighter-rouge"><span class="n">get_event_handler</span></code> method can either return an event handler class or nil, depending on whether it wants the event.  For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
  <span class="k">module</span> <span class="nn">Channels</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">get_event_handler</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span> 
      <span class="k">case</span> <span class="n">event_name</span>
      <span class="k">when</span> <span class="s2">"CharCreatedEvent"</span>
        <span class="k">return</span> <span class="no">CharCreatedEventHandler</span>
      <span class="k">end</span>
      <span class="kp">nil</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="event-handler-class">Event Handler Class</h3>

<p>The second piece is to implement a class to actually handle the plugin (<code class="language-ruby highlighter-rouge"><span class="no">CharCreatedEventHandler</span></code> in the example above.)  Event handling is much simpler than command handling.  There’s no arg parsing, no error checks–you only need to implement a single method, named <code class="language-ruby highlighter-rouge"><span class="n">on_event</span></code>.</p>

<p>The <code class="language-ruby highlighter-rouge"><span class="n">on_event</span></code> method is passed an event object.  The contents of this object will vary depending on the event.  You’ll need to look at the event class definition to find out what data is available.  See “Standard Events” below for more information.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
  <span class="k">module</span> <span class="nn">Channels</span>
    <span class="k">class</span> <span class="nc">CharCreatedEventHandler</span>
      <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
         <span class="n">event</span><span class="p">.</span><span class="nf">client</span><span class="p">.</span><span class="nf">emit</span> <span class="s2">"Hello!"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="standard-events">Standard Events</h2>

<p>Standard events in the stock Ares code include:</p>

<ul>
  <li><code class="language-ruby highlighter-rouge"><span class="no">CharConnectedEvent</span></code> - A character has disconnected.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">CharDisconnectedEvent</span></code> - A character has connected.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">CharCreatedEvent</span></code> - A new character was created.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">CronEvent</span></code> - Triggered periodically.  See <a href="/tutorials/code/cron.html">Cron Jobs</a>.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">ConfigUpdatedEvent</span></code> - The game configuration has changed.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">GameStartedEvent</span></code> - Triggered on startup.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">RoleDeletedEvent</span></code> - A role has been deleted.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="no">RoleChangedEvent</span></code> - A character’s roles has changed.</li>
</ul>

<p>You can find details about the data in these events by looking in the code file <code class="language-ruby highlighter-rouge"><span class="sr">/aresmush/en</span><span class="n">gine</span><span class="o">/</span><span class="n">aresmush</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">global_events</span></code>.  For example, character connected has the ID of the character and the client.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CharConnectedEvent</span>
  <span class="nb">attr_accessor</span> <span class="ss">:client</span><span class="p">,</span> <span class="ss">:char_id</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="alert alert-success">
<p><i class="fa fa-info-circle"></i> <b>Tip</b></p>
<p>Event objects always pass database **ids**, not actual database objects to avoid race conditions.  You can look up the character in the handler using  <code>Character[event.char_id]</code> .</p>
</div>

<h2 id="plugin-events">Plugin Events</h2>

<p>Other events may be defined by individual plugins. You’ll typically find those in the <code class="language-ruby highlighter-rouge"><span class="kp">public</span></code> directory of a plugin.  For example: <code class="language-ruby highlighter-rouge"><span class="n">aresmush</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">scenes</span><span class="o">/</span><span class="kp">public</span><span class="sr">/pose_event.rb</span></code>.</p>

             </div>             
                           </div>
              
                           <div class="col col-sm-3">
                                                 <div class="sidebar">   
                 
<div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                  
<div class="sidebar-title">See AresMUSH In Action</div>

<p>Visit the Ares <a href="http://mush.aresmush.com">Demo Game</a>.</p>

<p>Find other Ares games at <a href="http://arescentral.aresmush.com">AresCentral</a>.</p>


<div class="sidebar-title">Follow Us on Facebook</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1423276681271936";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-page" data-href="https://www.facebook.com/aresmush/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/aresmush/"><a href="https://www.facebook.com/aresmush/">Ares Mush</a></blockquote></div></div>

<div class="sidebar-title">Discuss Ares</div>

Have a question?  Want to talk about AresMUSH (or MU*s in general)?  Visit our <a href="http://forum.aresmush.com">Discussion Forum</a>.
                  
                  

                  <div class="sidebar-title">Stay Up to Date</div>
                          
                          Get important updates about Ares on <a href="https://www.facebook.com/aresmush/">Facebook</a> or the <a href="http://forum.aresmush.com">Discussion Forum</a>.

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>

                  

                  
                
                  
                           </div>
</div>
                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
