<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>FS3 Code Roadmap - </title>
    <meta property="og:title" content="FS3 Code Roadmap - ">
    <meta name="twitter:title" content="FS3 Code Roadmap - ">
    <meta itemprop="name" content="FS3 Code Roadmap - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="FS3 Code Roadmap" >
    <meta property="og:url" content="/tutorials/code/fs3-roadmap.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

<h1>FS3 Code Roadmap</h1>

    <div class="tags-box">
                 <ul class="tags-box">
                 
                 <li>[code]</li>
                 
                 <li>[fs3]</li>
                 
                 <li>[chargen]</li>
                 
                 </ul>
    </div>
                               
             <div class="page">
                 <p>Whether you’re modifying FS3 for your own house rules or using it as a pattern for your own skill system, it may help you to understand the key code blocks that make up the FS3 codebase.</p>

<div id="inline_toc">
  <p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#fs3-plugins" id="markdown-toc-fs3-plugins">FS3 Plugins</a></li>
  <li><a href="#fs3-skills" id="markdown-toc-fs3-skills">FS3 Skills</a>    <ul>
      <li><a href="#database-models" id="markdown-toc-database-models">Database Models</a></li>
      <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
      <li><a href="#helpers" id="markdown-toc-helpers">Helpers</a></li>
      <li><a href="#ability-types" id="markdown-toc-ability-types">Ability Types</a></li>
      <li><a href="#roll-parameters" id="markdown-toc-roll-parameters">Roll Parameters</a></li>
    </ul>
  </li>
  <li><a href="#fs3-combat" id="markdown-toc-fs3-combat">FS3 Combat</a>    <ul>
      <li><a href="#combat-messages" id="markdown-toc-combat-messages">Combat Messages</a></li>
      <li><a href="#database-models-1" id="markdown-toc-database-models-1">Database Models</a></li>
      <li><a href="#configuration-1" id="markdown-toc-configuration-1">Configuration</a></li>
      <li><a href="#helpers-1" id="markdown-toc-helpers-1">Helpers</a></li>
      <li><a href="#actions" id="markdown-toc-actions">Actions</a>        <ul>
          <li><a href="#action-example" id="markdown-toc-action-example">Action Example</a></li>
          <li><a href="#adding-a-new-action" id="markdown-toc-adding-a-new-action">Adding a New Action</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#web-portal" id="markdown-toc-web-portal">Web Portal</a>    <ul>
      <li><a href="#character-creation-abilities-tab" id="markdown-toc-character-creation-abilities-tab">Character Creation Abilities Tab</a></li>
      <li><a href="#profile-tab" id="markdown-toc-profile-tab">Profile Tab</a></li>
    </ul>
  </li>
</ul>

</div>

<h2 id="fs3-plugins">FS3 Plugins</h2>

<p>FS3 is implemented as two plugins:  FS3Skills (including luck and XP) and FS3Combat.  The combat plugin is separate so it can be easily disabled in games that don’t want automated combat.</p>

<h2 id="fs3-skills">FS3 Skills</h2>

<p>This section describes some important components of the FS3 Skills plugin.</p>

<h3 id="database-models">Database Models</h3>

<p>The FS3 code uses custom database models to store its data.  It <em>could</em> store everything as simple hashes on the Character object, but the FS3 ability types have a number of properties:  name, rating, XP spent, etc.  Having database models makes it easier to access those various fields individualy.  All of the FS3 data models use <a href="/tutorials/code/database.html">references</a> to connect them to the character:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FS3Attribute</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">reference</span> <span class="ss">:character</span><span class="p">,</span> <span class="s2">"AresMUSH::Character"</span>
  <span class="n">attribute</span> <span class="ss">:name</span>
  <span class="n">attribute</span> <span class="ss">:rating</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">DataType</span><span class="o">::</span><span class="no">Integer</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">FS3ActionSkill</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">reference</span> <span class="ss">:character</span><span class="p">,</span> <span class="s2">"AresMUSH::Character"</span>
  <span class="n">attribute</span> <span class="ss">:name</span>
  <span class="n">attribute</span> <span class="ss">:rating</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">DataType</span><span class="o">::</span><span class="no">Integer</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">Character</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">collection</span> <span class="ss">:fs3_attributes</span><span class="p">,</span> <span class="s2">"AresMUSH::FS3Attribute"</span>
  <span class="n">collection</span> <span class="ss">:fs3_action_skills</span><span class="p">,</span> <span class="s2">"AresMUSH::FS3ActionSkill"</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="configuration">Configuration</h3>

<p>FS3 is designed to be configured for individual games without needing to modify the code, so a <em>lot</em> of stuff is controlled by the configuration files.  The ability lists, chargen limits, starting skills, XP costs, and more are all set in the configuration files.  These are described in detail in <a href="/tutorials/config/index.html#fs3-config">Configuring FS3 Skills</a>.</p>

<h3 id="helpers">Helpers</h3>

<p>FS3 has a slew of shared helper methods, in separate files organized by topic:  rolls, chargen, xp, etc.   The helpers actually contain the meat of the system.  Most of the commands are actually prety bare-bones, doing little more than parsing args and calling helpers.</p>

<blockquote>
  <p><i class="fa fa-info-circle"></i> <strong>Tip:</strong> Having so many helper methods may be overwhelming at first, but dig into it a bit and hopefully you’ll find that having short, focused helpers makes the code easier to understand.</p>
</blockquote>

<h3 id="ability-types">Ability Types</h3>

<p>A lot of FS3 behaves differently for the different ability types.  For example, the code to set an ability generates a different database model for each type:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">In</span> <span class="sb">`plugins/fs3skills/helpers/chargen.rb`</span><span class="p">:</span>
<span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">set_ability</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">ability_name</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="k">case</span> <span class="n">ability_type</span>
  <span class="k">when</span> <span class="ss">:action</span>
    <span class="n">ability</span> <span class="o">=</span> <span class="no">FS3ActionSkill</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">character: </span><span class="n">char</span><span class="p">,</span> <span class="ss">name: </span><span class="n">ability_name</span><span class="p">,</span> <span class="ss">rating: </span><span class="n">rating</span><span class="p">)</span>
  <span class="k">when</span> <span class="ss">:background</span>
    <span class="n">ability</span> <span class="o">=</span> <span class="no">FS3BackgroundSkill</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="ss">character: </span><span class="n">char</span><span class="p">,</span> <span class="ss">name: </span><span class="n">ability_name</span><span class="p">,</span> <span class="ss">rating: </span><span class="n">rating</span><span class="p">)</span>
</code></pre></div></div>

<p>This is an important consideration if you were thinking about expanding FS3 for things like powers or another class of skill.  It’s really not designed for that, and it’s going to be a real pain to do.</p>

<h3 id="roll-parameters">Roll Parameters</h3>

<p>An important utility class in the skills plugin is <code class="language-ruby highlighter-rouge"><span class="no">RollParams</span></code>.  This method encapsulates the parameters that go into a roll: ability name, linked attribute and modifier.</p>

<p>Typically this will be built from the <code class="language-ruby highlighter-rouge"><span class="n">parse_roll_params</span></code> method, which cracks apart strings like <code class="language-ruby highlighter-rouge"><span class="n">roll</span> <span class="no">Firearms</span></code> and <code class="language-ruby highlighter-rouge"><span class="n">roll</span> <span class="no">Firearms</span><span class="o">+</span><span class="no">Brawn</span><span class="o">-</span><span class="mi">2</span></code>.</p>

<h2 id="fs3-combat">FS3 Combat</h2>

<p>This section describes some key components of the FS3 Combat plugin.</p>

<h3 id="combat-messages">Combat Messages</h3>

<p>Most emits are sent to everyone in the combat.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">emit_to_combat</span><span class="p">(</span><span class="n">combat</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">npcmaster_text</span><span class="p">)</span>
</code></pre></div></div>

<p>If a command can be executed by another player (common for NPCs, but sometimes used to take actions when someone is idle), you want to be sure to supply the “NPC Master Text”.  This is what generates the text at the end saying who did the command.  For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&lt;</span><span class="no">FS3Combat</span><span class="o">&gt;</span> <span class="no">Bob</span> <span class="n">will</span> <span class="n">reload</span> <span class="n">this</span> <span class="n">turn</span><span class="o">.</span> <span class="p">(</span><span class="n">by</span> <span class="no">Faraday</span><span class="p">)</span>
</code></pre></div></div>

<p>NPC Master Text can be generated automatically using the helper:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">npcmaster_text</span><span class="p">(</span><span class="n">character_or_npc_name</span><span class="p">,</span> <span class="n">enactor</span><span class="p">)</span>
</code></pre></div></div>

<p>Less commonly, you might want to emit only to the combat organizer (like when secret modifiers are applied) or to an individual combatant:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">emit_to_organizer</span><span class="p">(</span><span class="n">combat</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">npcmaster_text</span><span class="p">)</span>
<span class="no">FS3Combat</span><span class="p">.</span><span class="nf">emit_to_combatant</span><span class="p">(</span><span class="n">combatant</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p><i class="fa fa-info-circle"></i> <strong>Tip:</strong> Since combatants may be NPCs or PCs offline, it’s generally better to show the messages to everyone in combat rather than individual combatants.</p>
</blockquote>

<h3 id="database-models-1">Database Models</h3>

<p>Like the skills plugin, combat has its own set of database models.  The two at the core are <code class="language-ruby highlighter-rouge"><span class="no">Combat</span></code> - representing a combat instance - and <code class="language-ruby highlighter-rouge"><span class="no">Combatant</span></code> - representing someone involved in a combat.</p>

<p>The <code class="language-ruby highlighter-rouge"><span class="no">Combatant</span></code> class can reference either a character object (for a PC or ‘named’ NPC) or a virtual NPC object that will be recycled when the combat is over.  It stores all the combat-specific information like ammunition, gear, action and stance.  Information that persists when a combat is over, like damage, has its own separate model.</p>

<h3 id="configuration-1">Configuration</h3>

<p>The combat system is fully configurable, so it has a bunch of configuration files for everything from gear to hit locations.  These are described in detail in <a href="/tutorials/config/index.html#fs3-config">Configuring FS3 Combat</a>.</p>

<h3 id="helpers-1">Helpers</h3>

<p>Again, like the skills system, much of combat is encapsulated in short, focused helper methods: <code class="language-ruby highlighter-rouge"><span class="n">roll_defense</span></code>, <code class="language-ruby highlighter-rouge"><span class="n">attack_target</span></code>, <code class="language-ruby highlighter-rouge"><span class="n">determine_cover</span></code>, <code class="language-ruby highlighter-rouge"><span class="n">determine_damage</span></code>, <code class="language-ruby highlighter-rouge"><span class="n">weapon_defense_skill</span></code>, etc.  The commands are mostly lightweight wrappers for the helpers.</p>

<h3 id="actions">Actions</h3>

<p>All combat actions have a corresponding class that inherits from the <code class="language-ruby highlighter-rouge"><span class="no">CombatAction</span></code> class.   The base <code class="language-ruby highlighter-rouge"><span class="no">CombatAction</span></code> class provides some helpful utilities for parsing targets and some utility attributes like <code class="language-ruby highlighter-rouge"><span class="n">combatant</span></code> and <code class="language-ruby highlighter-rouge"><span class="nb">name</span></code>.</p>

<p>Each action must implement several methods:</p>

<ul>
  <li><code class="language-ruby highlighter-rouge"><span class="n">prepare</span></code> - Parses the action arguments, does error checking, and stores information in action-specific attributes.  May return an error message if there’s a problem.  This will be emitted to the player.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="n">print_action</span></code> - Prints the intended action in future tense, like:  “Faraday will attack Bob this turn.”</li>
  <li><code class="language-ruby highlighter-rouge"><span class="n">print_action_short</span></code> - Prints the intended action in a short format suitable for the combat HUD.</li>
  <li><code class="language-ruby highlighter-rouge"><span class="n">resolve</span></code> - Resolves the attack when a new turn is triggered.  Does damage, updates ammo, imposes penalties, or whatever other effects the action has.  Returns an array of messages with the results of the action.  These will be emitted to the combat.</li>
</ul>

<blockquote>
  <p><i class="fa fa-info-circle"></i> <strong>Tip:</strong> In addition to being called when the action is first set, <code class="language-ruby highlighter-rouge"><span class="n">prepare</span></code> is called whenever the combat HUD is viewed and when the action is performed.  If at any time the character’s action is no longer valid, the system will reset it.</p>
</blockquote>

<h4 id="action-example">Action Example</h4>

<p>The aim action is a good example to look at to see how this all works.</p>

<p>First is the class definition - notice that it inherits from <code class="language-ruby highlighter-rouge"><span class="no">CombatAction</span></code> so it has access to all the action utilities.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AimAction</span> <span class="o">&lt;</span> <span class="no">CombatAction</span>
</code></pre></div></div>

<p>Next is the prepare method.  Aim has only a single argument - the target name.  It can use the standard <code class="language-ruby highlighter-rouge"><span class="n">parse_targets</span></code> utility of the <code class="language-ruby highlighter-rouge"><span class="no">CombatAction</span></code> to turn a string like “Bob Joe” into a list of combatants representing the targets.  There’s also an error check to ensure that you only specify one combatant when aiming.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">prepare</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">parse_targets</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nf">action_args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">error</span> <span class="k">if</span> <span class="n">error</span>
    
    <span class="k">return</span> <span class="n">t</span><span class="p">(</span><span class="s1">'fs3combat.only_one_target'</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="nf">targets</span><span class="p">.</span><span class="nf">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kp">nil</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Notice that, like command error-checkers, prepare can either return an error message (if something is wrong) or nil (if everything is OK).</p>

<p>The two print action methods are pretty straightforward; they just return a message like “Faraday will aim at Bob” or “Aim Bob”.  Note that even though we know we only have one target, we can still use the <code class="language-ruby highlighter-rouge"><span class="n">print_target_names</span></code> utility from the base class to get a string with the name.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">print_action</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">t</span><span class="p">(</span><span class="s1">'fs3combat.aim_action_msg_long'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">:target</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">print_target_names</span><span class="p">)</span>
  <span class="k">end</span>
  
  <span class="k">def</span> <span class="nf">print_action_short</span>
    <span class="n">t</span><span class="p">(</span><span class="s1">'fs3combat.aim_action_msg_short'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">:target</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">print_target_names</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div></div>

<p>Last is the resolve method.  Aim is interesting because it doesn’t actually <em>do</em> anything immediately.  It’s a preparatory action that saves who the character is aiming at.  The resolution message is simply “Faraday aims at Bob.”</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">resolve</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">combatant</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">aim_target: </span><span class="nb">self</span><span class="p">.</span><span class="nf">target</span><span class="p">)</span>
    <span class="p">[</span><span class="n">t</span><span class="p">(</span><span class="s1">'fs3combat.aim_resolution_msg'</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">:target</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="p">.</span><span class="nf">print_target_names</span><span class="p">)]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>So where does the aim actually take effect?  Like many combat properties, it is used in various helper methods.  Specifically, when determining whether an attack hits (in <code class="language-ruby highlighter-rouge"><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">roll_attack</span></code>), it does this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">aiming_mod</span> <span class="o">=</span> <span class="p">(</span><span class="n">combatant</span><span class="p">.</span><span class="nf">is_aiming?</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">combatant</span><span class="p">.</span><span class="nf">aim_target</span> <span class="o">==</span> <span class="n">combatant</span><span class="p">.</span><span class="nf">action</span><span class="p">.</span><span class="nf">target</span><span class="p">))</span> <span class="p">?</span> <span class="mi">3</span> <span class="p">:</span> <span class="mi">0</span>
</code></pre></div></div>

<p>If the combatant is aiming and hasn’t changed targets since they aimed, give them a +3 modifier.</p>

<p>Other types of actions may initiate attacks (using <code class="language-ruby highlighter-rouge"><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">attack_target</span></code>), trigger a recovery check (using <code class="language-ruby highlighter-rouge"><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">check_for_unko</span></code>), or update other combat properties (like reloading, which uses <code class="language-ruby highlighter-rouge"><span class="n">combatant</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="ss">ammo: </span><span class="n">combatant</span><span class="p">.</span><span class="nf">max_ammo</span><span class="p">)</span></code>).</p>

<p>Finally, it’s worth noting that many combat properties get reset at the end of a turn.  The aim target, for instance, is cleared if you end a turn with an action other than ‘aim’ set.  This is all handled in the <code class="language-ruby highlighter-rouge"><span class="no">FS3Combat</span><span class="p">.</span><span class="nf">reset_for_new_turn</span></code> method.</p>

<h4 id="adding-a-new-action">Adding a New Action</h4>

<p>If you create a brand new combat action, you’ll need to register it with the <code class="language-ruby highlighter-rouge"><span class="n">find_action_klass</span></code> method in <code class="language-ruby highlighter-rouge"><span class="n">plugins</span><span class="o">/</span><span class="n">fs3combat</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">actions_helper</span><span class="p">.</span><span class="nf">rb</span></code>.  This is essentially a mini dispatcher for combat action commands.</p>

<h2 id="web-portal">Web Portal</h2>

<p>One of the really nice selling points of Ares is the web portal, so you’ll want to consider having a web-based chargen for your system.  FS3 has several web components.</p>

<h3 id="character-creation-abilities-tab">Character Creation Abilities Tab</h3>

<p>Much of the web chargen is generic - demographics, background, groups, etc.  The FS3 bits are centered in the Abilities tab.  The <code class="language-ruby highlighter-rouge"><span class="no">FS3Skills</span><span class="o">::</span><span class="no">ChargenCharRequestHandler</span></code> provides information driving this screen, representing the character’s current abilities and specialties in hash form.   <code class="language-ruby highlighter-rouge"><span class="no">FS3Skills</span><span class="o">::</span><span class="no">ChargenInfoRequestHandler</span></code> specifies the general information about what abilities are available and what skill limits are in effect.</p>

<p>On the Ember side, the <code class="language-ruby highlighter-rouge"><span class="n">chargen</span><span class="p">.</span><span class="nf">js</span></code> controller has a lot of logic to perform some client-side error checking.  This is not strictly necessary; everything will be fully error-checked by the server on the review screen.  But having the most commonly-encountered errors client-side makes a much more pleasant experience for the players.</p>

<p>Several Ember <strong>Components</strong> encapsulate the display and controls for modifying a single ability.  For example, the fs3-actionbox component includes everything needed for one of the action skill rows:</p>

<figure>

    <div class="figure-contents">

        
           <a class="no_icon" target="_blank" href="/images/code/ability-box.png">
        

          <img class="docimage" src="/images/code/ability-box.png" alt="" />

          </a>

          

        </div>

</figure>

<h3 id="profile-tab">Profile Tab</h3>

<p>The <code class="language-ruby highlighter-rouge"><span class="n">fs3</span><span class="o">-</span><span class="n">sheet</span></code> and <code class="language-ruby highlighter-rouge"><span class="n">fs3</span><span class="o">-</span><span class="n">damage</span></code> components are used on the character profile system tab to show simple lists of the character’s skills and any damage taken.</p>

             </div>             
                           </div>
              
                           <div class="col col-sm-3">
                                                 <div class="sidebar">   
                 
<div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                  
<div class="sidebar-title">See AresMUSH In Action</div>

<p>Visit the Ares <a href="http://mush.aresmush.com">Demo Game</a>.</p>

<p>Find other Ares games at <a href="http://arescentral.aresmush.com">AresCentral</a>.</p>


<div class="sidebar-title">Follow Us on Facebook</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1423276681271936";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-page" data-href="https://www.facebook.com/aresmush/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/aresmush/"><a href="https://www.facebook.com/aresmush/">Ares Mush</a></blockquote></div></div>

<div class="sidebar-title">Discuss Ares</div>

Have a question?  Want to talk about AresMUSH (or MU*s in general)?  Visit our <a href="http://forum.aresmush.com">Discussion Forum</a>.
                  
                  

                  <div class="sidebar-title">Stay Up to Date</div>
                          
                          Get important updates about Ares on <a href="https://www.facebook.com/aresmush/">Facebook</a> or the <a href="http://forum.aresmush.com">Discussion Forum</a>.

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>

                  

                  
                
                  
                           </div>
</div>
                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
