<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="twitter:card" content="summary">

<!-- Schema.org markup for Google+ -->
<!-- Twitter Card data -->
<!-- Open Graph data -->

    <meta name="google-site-verification" content="GK5cKdKe-CQEFsGx1pPxHFhflO88ddWG8NdWk_KDabA" />
    
    <title>Reloading Code - </title>
    <meta property="og:title" content="Reloading Code - ">
    <meta name="twitter:title" content="Reloading Code - ">
    <meta itemprop="name" content="Reloading Code - ">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="">
    <meta property="og:site_name" content="Reloading Code" >
    <meta property="og:url" content="/tutorials/code/reload.html" >
    
  
    <meta name="description" content=" ...">
    <meta property="og:description" content=" ..." >
    <meta name="twitter:description" content=" ...">  
    <meta itemprop="description" content=" ...">
  
    
  
    <meta property="og:image" content="/default_preview.png">
    <meta name="twitter:image" content="/default_preview.png">
    <meta itemprop="image" content="/default_preview.png">
  
  
  <meta name="twitter:site" content="@lynnnoton">
  <meta name="twitter:creator" content="@lynnnoton">

  
    <!-- 
    
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    
    -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="https://use.fontawesome.com/ee2438614b.js"></script>
       
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?autoload=true&amp;skin=sunburst&amp;lang=css" defer="defer"></script>


    <script>
        (function() {
          var cx = '006109472892303620439:hmwpm8s4lvi';
          var gcse = document.createElement('script');
          gcse.type = 'text/javascript';
          gcse.async = true;
          gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(gcse, s);
        })();
    </script>
      
    <script src="/scripts/default.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css">


    <link rel="stylesheet" type="text/css" href="/css/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/tables.css"></link>
    <link rel="stylesheet" type="text/css" href="/css/prettify.css"></link>
    
    
      <link rel="shortcut icon" href="/images/favicon.ico">
      <link rel="apple-touch-icon" href="/images/touchicon_57.png">
      <link rel="apple-touch-icon" sizes="72x72" href="/images/touchicon_62.png">
      <link rel="apple-touch-icon" sizes="114x114" href="/images/touchicon_114.png">
      
      
  </head>

  <body>

      <a name="top"></a>     
         
         
                               
                      <div class="titlebox">
                                                    
                         <div class="blogtitle">
                          
                              <a href="">AresMUSH</a> 
                              
                          </div>
                          
                          <div class="tagline">
                                A New Breed of MUSH Server            
                            </div>
                            
                            </div>
                             
                      
                            <nav class="navbar navbar-dark">
 
    <ul class="nav navbar-nav">
      <li class="active">
        <a href="/">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Features <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/features/">Why Ares?</a></li>
          <li><a href="/features/ares-for-players.html">Ares for Players</a></li>
          <li><a href="/features/ares-for-admins.html">Ares for Admins</a></li>
          <li><a href="/features/ares-for-coders.html">Ares for Coders</a></li>
          <li><hr/></li>
          <li><a href="/web-portal">The Web Portal</a></li>
          <li><a href="/features/skills.html">Skills Systems</a></li>
          <li><a href="/handles">Player Handles</a></li>
          <li><a href="/features/server-roundup.html">Server Comparison</a></li>
        </ul>
      </li>  
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/mush-101">MUSH 101</a></li>
          <li><a href="/tutorials/play">Playing Ares</a></li>
          <li><a href="/tutorials/install">Installing Ares</a></li>
          <li><a href="/tutorials/config">Configuring Ares</a></li>
          <li><a href="/tutorials/manage">Managing Ares</a></li>
          <li><a href="/tutorials/code">Coding for Ares</a></li>
        </ul>
      </li>    
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">FS3 <span class="caret"></span></a>

        <ul class="dropdown-menu">
          <li><a href="/fs3/">FS3 Home</a></li>
          <li><a href="/fs3/fs3-3/">Player's Guide</a></li>
          <li><a href="/fs3/fs3-3/roll-quickref.html">Skills Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-quickref.html">Combat Quick Reference</a></li>
          <li><a href="/fs3/fs3-3/combat-walkthrough.html">Interactive Combat Walkthrough</a></li>
          <li><a href="/fs3/old-editions.html">Prior Edition Guides</a></li>
        </ul>
      </li>
      
      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Code <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/code/">Source Code</a></li>
          <li><a href="/tutorials/code">Learn to Code</a></li>
          <li><a href="https://github.com/AresMUSH/aresmush/releases">Release Notes <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>
      
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community <span class="caret"></span></a>
        
        <ul class="dropdown-menu">
          <li><a href="http://arescentral.aresmush.com">AresCentral Directory <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://forum.aresmush.com">Discussion Forum <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
          <li><a href="http://logcleaner.aresmush.com/">RP Log Cleaner <i class="fa fa-external-link" aria-hidden="true"></i></a></li>
        </ul>
      </li>

      <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
        <ul class="dropdown-menu">
          <li><a href="/feedback.html">Contact Us</a>
          <li><a href="/license.html">License</a>
          <li><a href="/privacy.html">Privacy Policy</a>
        </ul>
      </li>

    </ul>
</nav>

                      
                        
         
         <div class="page-block">
         
                           <div class="row">
                         
                         
    <div class="col col-sm-9">   

<h1>Reloading Code</h1>

    <div class="tags-box">
                 <ul class="tags-box">
                 
                 <li>[code]</li>
                 
                 <li>[plugins]</li>
                 
                 <li>[reload]</li>
                 
                 </ul>
    </div>
                               
             <div class="page">
                 <p>Changes to the Ares game engine require a <a href="/tutorials/manage/shutdown.html">restart</a>, but the plugins can be reloaded while the game is running.</p>

<div id="inline_toc">
  <p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#how-to-reload" id="markdown-toc-how-to-reload">How to Reload</a></li>
  <li><a href="#how-code-is-loaded" id="markdown-toc-how-code-is-loaded">How Code is Loaded</a></li>
  <li><a href="#loading-pitfalls" id="markdown-toc-loading-pitfalls">Loading Pitfalls</a>    <ul>
      <li><a href="#database-models" id="markdown-toc-database-models">Database Models</a></li>
      <li><a href="#module-mix-ups" id="markdown-toc-module-mix-ups">Module Mix-Ups</a></li>
      <li><a href="#killing-the-manager" id="markdown-toc-killing-the-manager">Killing the Manager</a></li>
    </ul>
  </li>
</ul>

</div>

<h2 id="how-to-reload">How to Reload</h2>

<p>If you’ve only changed <strong>plugins</strong>, you can reload each plugin while the game is still running by using the <code class="language-ruby highlighter-rouge"><span class="nb">load</span> <span class="o">&lt;</span><span class="n">plugin</span> <span class="nb">name</span><span class="o">&gt;</span></code> command in-game.</p>

<p>If all you’ve changed are <strong>configuration files</strong>, the <code class="language-ruby highlighter-rouge"><span class="nb">load</span> <span class="n">config</span></code> command will read them.   The config is automatically reloaded when using the Web Portal config editor.</p>

<p>If you’ve changed the <strong>Web Portal</strong>, you’ll need to re-deploy it through the Admin -&gt; Manage menu on the Web Portal or the <code class="language-ruby highlighter-rouge"><span class="n">website</span><span class="o">/</span><span class="n">deploy</span></code> command in-game.</p>

<p>If you’ve changed the <strong>engine</strong>, you’ll need to actually <a href="/tutorials/manage/shutdown.html">shutdown and restart</a> the game before the changes will take effect.   You probably shouldn’t be changing the engine, though.</p>

<h2 id="how-code-is-loaded">How Code is Loaded</h2>

<p>The load command lets you reload the code for a specific plugin.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">load</span> <span class="n">fs3skills</span>
<span class="sx">%% Plugin 'fs3skills' loading.  Please wait...
%% Plugin </span><span class="s1">'fs3skills'</span> <span class="p">(</span><span class="n">including</span> <span class="n">config</span><span class="p">,</span> <span class="n">help</span> <span class="n">and</span> <span class="n">locale</span><span class="p">)</span> <span class="n">reloaded</span><span class="o">.</span>
</code></pre></div></div>

<p>To understand the reload feature (and its limitations), it helps to understand a bit about how Ruby loads code.</p>

<p>Take the following example of tinker_cmd.rb:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
    <span class="k">module</span> <span class="nn">Tinker</span>
        <span class="k">class</span> <span class="nc">TinkerCmd</span>
        <span class="c1"># ... other stuff </span>
        
        <span class="k">def</span> <span class="nf">handle</span>
          <span class="n">client</span><span class="p">.</span><span class="nf">emit_success</span> <span class="s2">"Done!"</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When Ruby loads this file, it creates a module <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span></code>, then a module <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span><span class="o">::</span><span class="no">Tinker</span></code>, then a class <code class="language-ruby highlighter-rouge"><span class="no">TinkerCmd</span></code>, then it adds the <code class="language-ruby highlighter-rouge"><span class="n">handle</span></code> method to the command class.  The handle method contains a single emit.</p>

<p>Let’s say we change the command’s behavior:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
    <span class="k">module</span> <span class="nn">Tinker</span>
        <span class="k">class</span> <span class="nc">TinkerCmd</span>
        <span class="c1"># ... other stuff </span>
        
        <span class="k">def</span> <span class="nf">handle</span>
          <span class="n">client</span><span class="p">.</span><span class="nf">emit_success</span> <span class="s2">"Starting!"</span>
          <span class="n">client</span><span class="p">.</span><span class="nf">emit_success</span> <span class="s2">"Definitely Done!"</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When we reload the tinker plugin, Ares first <em>unloads</em> the old one.  Anything in the <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span><span class="o">::</span><span class="no">Tinker</span></code> module is deleted from memory so we can start fresh.  When Ruby encounters the <code class="language-ruby highlighter-rouge"><span class="k">module</span> <span class="nn">Tinker</span></code> line, it’ll create a new <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span><span class="o">::</span><span class="no">Tinker</span></code> module containing the new code.   The next time someone uses the tinker command, they’ll get the new behavior.</p>

<h2 id="loading-pitfalls">Loading Pitfalls</h2>

<p>The reload functionality works pretty well overall, but there are a few situations that can cause issues.</p>

<h3 id="database-models">Database Models</h3>

<p>Database models don’t belong to a plugin module - they’re always part of the root <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span></code> module.  (There are reasons for this, which we won’t go into here.)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
  <span class="k">class</span> <span class="nc">GameMap</span> <span class="o">&lt;</span> <span class="no">Ohm</span><span class="o">::</span><span class="no">Model</span>
    <span class="c1"># ... other stuff</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Since the database models aren’t part of the plugin module, they won’t be <em>unloaded</em> before being reloaded.  Because of this, you can <strong>add</strong> things to database models through a reload, but you can’t remove things.</p>

<h3 id="module-mix-ups">Module Mix-Ups</h3>

<p>Sometimes you’ll accidentally put code in the wrong module.  For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">AresMUSH</span>
    <span class="k">module</span> <span class="nn">Chargen</span>
        <span class="k">class</span> <span class="nc">TinkerCmd</span>
        <span class="c1"># ...</span>
</code></pre></div></div>

<p>You wanted <code class="language-ruby highlighter-rouge"><span class="no">TinkerCmd</span></code> to be in the Tinker module, but instead it ended up in the Chargen module.</p>

<p>Reloading the Tinker module (after fixing the code) will add the <code class="language-ruby highlighter-rouge"><span class="no">AresMUSH</span><span class="o">::</span><span class="no">Tinker</span><span class="o">::</span><span class="no">TinkerCmd</span></code> class correctly.  But the one in Chargen is still there.</p>

<p>Normally this doesn’t do any harm.  Having an extra, unused command laying around the Chargen module doesn’t really matter.  But if it were a database model or an interface method, it may cause some unexpected behavior.  Just reload the Chargen plugin to fix it.</p>

<h3 id="killing-the-manager">Killing the Manager</h3>

<p>The Manage plugin is the one that provides all the code necessary to load other code.  Be extra cautious when making code changes to the Manage plugin.  If anything goes haywire when loading it, you’ll find yourself without a Manage plugin … which means you won’t be able to load any other code!   The only way to recover from that is to <a href="/tutorials/manage/shutdown.html">shutdown</a> and restart the game.</p>

             </div>             
                           </div>
              
                           <div class="col col-sm-3">
                                                 <div class="sidebar">   
                 
<div id="search-box">
  <!-- SearchBox widget will appear here -->
</div>
                  
<div class="sidebar-title">See AresMUSH In Action</div>

<p>Visit the Ares <a href="http://mush.aresmush.com">Demo Game</a>.</p>

<p>Find other Ares games at <a href="http://arescentral.aresmush.com">AresCentral</a>.</p>


<div class="sidebar-title">Follow Us on Facebook</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1423276681271936";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-page" data-href="https://www.facebook.com/aresmush/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/aresmush/"><a href="https://www.facebook.com/aresmush/">Ares Mush</a></blockquote></div></div>

<div class="sidebar-title">Discuss Ares</div>

Have a question?  Want to talk about AresMUSH (or MU*s in general)?  Visit our <a href="http://forum.aresmush.com">Discussion Forum</a>.
                  
                  

                  <div class="sidebar-title">Stay Up to Date</div>
                          
                          Get important updates about Ares on <a href="https://www.facebook.com/aresmush/">Facebook</a> or the <a href="http://forum.aresmush.com">Discussion Forum</a>.

              <div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Search Results</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
       

       <div id="search-hits">
         <!-- Hits widget will appear here -->
       </div>


       <div id="search-pagination">
         <!-- Pagination widget will appear here -->
       </div>
       
       
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>


<script src="/scripts/search.js"></script>
<script>
  initializeSearch( 'NI38C577BA',
    '29793fd9084a3446072c14e471e32589',
    'aresmush.com',
    ' ' );
</script>

                  

                  
                
                  
                           </div>
</div>
                          
              </div>
              
          </div>
          

          <div class="footer">
             <p> &copy;  2013 with help from the <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> blog engine.
              </p>
          </div>
          
      
     
  </body>
</html>
